export ZPLUG_HOME=/usr/local/opt/zplug

source $ZPLUG_HOME/init.zsh

zplug "zsh-users/zsh-history-substring-search"
zplug "zsh-users/zsh-completions"
zplug "plugins/git", from:oh-my-zsh
zplug "zsh-users/zsh-history-substring-search"
zplug "themes/clean", from:oh-my-zsh
zplug "zsh-users/zsh-syntax-highlighting", nice:10

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
  printf "Install? [y/N]: "
  if read -q; then
    echo; zplug install
  fi
fi

# Then, source plugins and add commands to $PATH
zplug load

export KEYTIMEOUT=1
# set -o vi
set -o emacs

# History options
# ## Command history configuration
if [ -z "$HISTFILE" ]; then
  HISTFILE=$HOME/.zsh_history
fi

HISTSIZE=10000
SAVEHIST=10000

# Show history
case $HIST_STAMPS in
  "mm/dd/yyyy") alias history='fc -fl 1' ;;
  "dd.mm.yyyy") alias history='fc -El 1' ;;
  "yyyy-mm-dd") alias history='fc -il 1' ;;
  *) alias history='fc -l 1' ;;
esac

setopt append_history
setopt extended_history
setopt hist_expire_dups_first
setopt hist_ignore_dups # ignore duplication command history list
setopt hist_ignore_space
setopt hist_verify
setopt inc_append_history
setopt share_history # share command history data

bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down

bindkey -M emacs '^P' history-substring-search-up
bindkey -M emacs '^N' history-substring-search-down

# Handle dup path in tmux for Mac OS X
# http://superuser.com/questions/544989/does-tmux-sort-the-path-variable/583502#583502
if [[ `uname` == "Darwin" ]]; then
  if [ -f /etc/profile ]; then
    PATH=""
    source /etc/profile
  fi
fi

if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  export EDITOR='nvim'
fi

# Allow [ or ] whereever you want
unsetopt nomatch

# Go
export GOPATH="$HOME/code/go"

# PATH setup
export PATH="/usr/local/sbin:$HOME/.nvm/versions/node/v5.2.0/bin:$PATH"
export PATH="$PATH:$HOME/bin:$HOME/.fzf/bin:$HOME/.multirust/toolchains/stable/cargo/bin:/usr/local/opt/go/libexec/bin:$GOPATH/bin"

# Load FZF
[ -f ~/.fzf/shell/key-bindings.zsh ] && source ~/.fzf/shell/key-bindings.zsh
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Sourcing of other zsh files
source $HOME/code/dotfiles/files/zsh/aliases
source $HOME/code/dotfiles/files/zsh/z
source /usr/local/share/zsh/site-functions

# autoload -U compinit && compinit

if [[ `uname` == "Darwin" ]]; then
  source ~/.zshrc.mac
fi

if [[ `uname` == "Linux" ]]; then
  source ~/.zshrc.linux
fi
